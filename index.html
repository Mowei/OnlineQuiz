<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>線上測試</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .quiz-container { max-width: 400px; margin: auto; }
        .option { display: block; margin: 10px 0; }
        .result { margin-top: 20px; font-weight: bold; }
        .score { margin-top: 20px; font-size: 18px; font-weight: bold; }
    </style>
</head>
<body>
	<input type="file" id="fileInput">
	<button onclick="loadFile()">讀取檔案</button>
    <div class="quiz-container">
        <h2>測試題目：</h2>
        <p id="question"></p>
        <div id="options"></div>
        <button onclick="checkAnswer()">提交答案</button>
        <p class="result" id="result"></p>
        <p class="score" id="score">分數: 0</p>
    </div>
    <script>
		
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
		
        function loadFile() {
            const fileInput = document.getElementById("fileInput");
            const file = fileInput.files[0];
            if (!file) {
                alert("請選擇一個檔案");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const text = event.target.result;
				questions = JSON.parse(text);
				loadQuestion();
            };
			reader.readAsText(file);


        }


        async function loadQuestions() {
            try {
                const response = await fetch('questions.json');
                questions = await response.json();
                loadQuestion();
            } catch (error) {
                console.error("無法載入題庫", error);
            }
        }

        function loadQuestion() {

            if (questions.length === 0) return;
            const quiz = questions[currentQuestionIndex];
            document.getElementById("question").textContent = (currentQuestionIndex + 1) + ". " + quiz.question;
            const optionsDiv = document.getElementById("options");
            optionsDiv.innerHTML = "";
			for(let i=0 ;i<quiz.options.length;i++){
			console.log(quiz.options[i]);
            //quiz.options.forEach(option => {
                const label = document.createElement("label");
                label.classList.add("option");
                label.innerHTML = `<input type="radio" name="answer" value="${quiz.options[i].key}"> ${quiz.options[i].key}.${quiz.options[i].value}`;
                optionsDiv.appendChild(label);
				console.log(label);
            //});
			}
            restoreSelection();
        }

        function checkAnswer() {
            if (questions.length === 0) return;
            const correctAnswer = questions[currentQuestionIndex].answer;
            const selected = document.querySelector('input[name="answer"]:checked');
            if (!selected) {
                document.getElementById("result").textContent = "請選擇一個答案！";
                return;
            }
            if (selected.value === correctAnswer) {
                document.getElementById("result").textContent = "正確！";
                score++;
            } else {
                document.getElementById("result").textContent = "錯誤，請再試一次！";
            }
            localStorage.setItem("selectedAnswer", selected.value);
            localStorage.setItem("score", score);
            updateScore();
        }

        function restoreSelection() {
            const savedAnswer = localStorage.getItem("selectedAnswer");
            if (savedAnswer) {
                const radioButtons = document.querySelectorAll('input[name="answer"]');
                radioButtons.forEach(radio => {
                    if (radio.value === savedAnswer) {
                        radio.checked = true;
                    }
                });
            }
            const savedScore = localStorage.getItem("score");
            if (savedScore) {
                score = parseInt(savedScore, 10);
                updateScore();
            }
        }

        function updateScore() {
            document.getElementById("score").textContent = "分數: " + score;
        }

        //loadQuestions();
    </script>
</body>
</html>
